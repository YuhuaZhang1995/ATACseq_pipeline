 # ATACseq_pipeline

This is an automatic pipeline of processing ATAC-seq data, which includes adapter-trimming, alignment, filtering and ploting.

## Usage of the ATACseq_pipeline: 

python command.py <config_file>

## Component of config_file:

1. Procedures to be involved, start with **##**, e.g. **_##alignment_**
2. Parameters for the corresponding procedure, start with **--**,e.g. **_--batch 14_**

## A quick start
In this case, the program will go through the whole procedure, and generate the intermediate files at each step and final results. The user need to specify **at least** the required parameters.

- **Required parameter**

`--seq_data`: Pathway to the sequence data, end with Run_XXX, no '/' included at the end; the program will search for '/elder' folder and find the sequence data, **_e.g. --seq_data /pathway/to/data/Run_XXX_**

`--core_info_file`: The core information files, **_e.g. /pathway/to/file/Batch14_Run_1789_elder.txt_**;

`--batch`: The batch number, e.g. **_--batch 14_**;

`--run`: The run number, e.g. **_--run 1789_**;

`--conf`: The config file used by gotcloud. Please don't specify OUT_DIR and FASTQ_LIST in the config file. **_e.g. --conf /patheway/to/config_file_**

- **Optional parameter**

`--specific_output`: The output pathway file that contains the specific output for each step; **_e.g. --specific_output /pathway/to/file_**. The output pathway file should contain the specific pathway to store the intermediate files generated by the pipeline, specified by **_--output_AT_core_info --out_bam --out_proc_bam --out_plot_**. If not specified every output pathway, the default will be the current pathway.

`--entire_output`: Where you would like to store the all the output(intermediate files and final results). The default is the current direrctory; 

`--job_AT`: Number of process for adapter trimming step, the default is 5;

`--job_align`: Number of process for alignment, the default is 3. Please pay attention to the **memory**, as the demand for the memory is considerably high;

`--job_filter`: Number of process for filtering, the default is 5;

`--intermediate_file`: Whether to keep the intermediate .bam files generated in the filtering step, the default is no. e.g. **_--intermediate_file Yes_**


- **A brief example of config_file**

--entire_output .

--specific_output ./output_file

--batch 14

--run 1789

--job_AT 5

--seq_data /pathway/to/seq/data

--core_info_file /core/info/file.txt

--job_align 5

--conf /pathway/to/config_file

--job_filter 5

--intermediate_file Yes


## Separate each step
If the user prefer to run each procedure step by step and specify the output pathway for the intermediate files, just make the config_file contains only one operation each time.

- **Adapter_trimming**

This step will generate the trimmed files under the same directory as the input sequence data, as well as the extracted information from the input core info file(sampleID, cell line description and patient ID). 

`--core_info_file`: The core information files, **_e.g. /pathway/to/file/Batch14_Run_1789_elder.txt_**;

`--seq_data`: Pathway to the sequence data, end with Run_XXX, no '/' included at the end; the program will search for '/elder' folder and find the sequence data, **_e.g. --seq_data /pathway/to/data/Run_XXX_**

`--job_AT`: Optional parameter. Number of process for adapter trimming step, the default is 5;

`--output_AT_core_info`: Optional parameter. Directory to store the generated sample info file, **_e.g. /pathway/to/store_**


**_Example_**

##adapter_trimming

--core_info_file /core/info.txt

--job_AT 5

--seq_data /pathway/to/seq/data

--output_AT_core_info /pathway/to/store


- **Alignment**

This step will generate the aligned .bam files as well as a metaCloudbamfiles which will be used for the filtering.

`--trimmed_file`: Pathway to the trimmed files, end with Run_XXX, no '/' included at the end; the program will search for '/elder' folder and find the sequence data;

`--out_conf`: Directory to store config and index files that would be used by gotcloud;

`--out_bam`: Directory to store the output bam files;

`--batch`: The batch number, e.g. **_--batch 14_**;

`--run`: The run number, e.g. **_--run 1789_**;

`--conf`: The config_file used by gotcloud, **_e.g. --conf /pathway/to/config_file_**;

`--job_align`: Optional parameter. Number of process for alignment, the default is 3. Please pay attention to the **memory**, as the demand for the memory is considerably high;


**_Example_**

##alignment

--job_align 5

--trimmed_file /pathway/to/adapter/trimmed/file

--out_conf /directory/to/store/config/index/files/for/gotcloud

--out_bam /output/directory/to/store/generated/bam/file

--batch 14

--run 1789

--conf /pathway/to/config_file


- **Filtering**

This step will generate the filtered .bam file as well as the metagotCloudbamfiles which will be used in the plotting step. Whether to keep the intermediate files is up to the users.

`--in_bam`: MetagotCloud files. e.g. **_--in_bam /pathway/metaXXXX_**;

`--out_proc_bam`: Output dir for processed .bam files;

`--batch`: The batch number, e.g. **_--batch 14_**;

`--run`: The run number, e.g. **_--run 1789_**;

`--job_filter`: Optional parameter. Number of process for filtering, the default is 5;

`--intermediate_file`: Optional parameter. Whether to keep the intermediate .bam files generated in the filtering step, the default is no. e.g. **_--intermediate_file Yes_**



**_Example_**

##filtering

--job_filter 5

--out_proc_bam /pathway

--in_bam /pathway/metagotCloudbamfiles_Batch14_Run1789

--intermediate_file Yes

--batch 14

--run 1789

- **Plotting**

This step will generate the plots of the frequency of the insert sizes, compared the filtered reads to the unfiltered reads.

`--in_bam`: MetagotCloud files. e.g. **_--in_bam /pathway/metaXXXX_**;

`--in_bam_filtered`: MetagotCloud files for filtered reads. e.g. **_--in_bam /pathway/metaXXXX_**;

`--out_plot`: The directory to store the generated plots;

**_Example_**

##plotting

--in_bam /pathway/meta_file

--in_bam_filtered /pathway/meta_filtered_file

--out_plot /pathway/plot
